# Getting Started with Mapgen

## Installation

### Step 1: Add NuGet Package

Add the following package to your project:

```bash
dotnet add package Mapgen.Analyzer
```

Or manually edit your `.csproj` file:

```xml
<ItemGroup>
    <PackageReference Include="Mapgen.Analyzer" Version="1.1.0">
        <PrivateAssets>all</PrivateAssets>
        <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
</ItemGroup>
```

**Note:** The `Mapgen.Analyzer` package must be configured as an analyzer with `OutputItemType="Analyzer"` and `ReferenceOutputAssembly="false"`. The `MapperAttribute` and other abstractions are automatically generated by the analyzer.

### Step 2: Define Your Models

```csharp
// Source model
public class User
{
    public int Id { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public DateTime BirthDate { get; set; }
}

// Destination model (DTO)
public class UserDto
{
    public int Id { get; set; }
    public string FullName { get; set; }
    public int Age { get; set; }
}
```

### Step 3: Create a Mapper

```csharp
using Mapgen.Analyzer;

[Mapper]
public partial class UserMapper
{
    // Declare the mapping method signature as a partial method
    public partial UserDto ToDto(User source);

    // Configure custom mappings in the constructor
    public UserMapper()
    {
        MapMember(dto => dto.FullName, 
                  user => $"{user.FirstName} {user.LastName}");
        
        MapMember(dto => dto.Age, 
                  user => CalculateAge(user.BirthDate));
    }

    private static int CalculateAge(DateTime birthDate)
    {
        var today = DateTime.Today;
        var age = today.Year - birthDate.Year;
        if (birthDate.Date > today.AddYears(-age)) age--;
        return age;
    }
}
```

### Step 4: Use the Mapper

You can use the mapper in two ways:

#### Option 1: Instance Method
```csharp
var mapper = new UserMapper();
var userDto = mapper.ToDto(user);
```

#### Option 2: Extension Method (Auto-Generated)
```csharp
var userDto = user.ToDto();
```

Mapgen automatically generates extension methods on your source types for convenience!

## How It Works

1. **Compile Time**: When you build your project, Mapgen's source generator analyzes your mapper classes
2. **Code Generation**: It generates:
   - The implementation of your partial mapping methods
   - Extension methods for your source types
   - All necessary mapping logic as plain C# code
3. **Zero Runtime Cost**: The generated code is as fast as hand-written code - no reflection!
4. **Compile-time analysis**: Destination is always right. If you missed the property mapping - Mapgen will let you know.

## Basic Mapping Rules

### Automatic Property Mapping

Properties with matching names and compatible types are mapped automatically:

```csharp
// Source
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
}

// Destination
public class ProductDto
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
}

// Mapper - no configuration needed for matching properties!
[Mapper]
public partial class ProductMapper
{
    public partial ProductDto ToDto(Product source);
}
```

### Custom Property Mapping

Use `MapMember()` to customize how properties are mapped:

```csharp
[Mapper]
public partial class ProductMapper
{
    public partial ProductDto ToDto(Product source);

    public ProductMapper()
    {
        // Map with expression
        MapMember(dto => dto.FormattedPrice, 
                  product => $"${product.Price:F2}");
        
        // Map with method reference
        MapMember(dto => dto.Category, GetCategory);
    }

    private static string GetCategory(Product product) 
    {
        // Complex logic here
        return product.Price > 100 ? "Premium" : "Standard";
    }
}
```

### Ignoring Properties

Use `IgnoreMember()` to exclude properties from mapping:

```csharp
public ProductMapper()
{
    IgnoreMember(dto => dto.InternalCode);
}
```

## Next Steps

- Learn about [Core Features](core-features.md)
- Explore [Advanced Usage](advanced-usage.md)
- Review [Best Practices](migration/best-practices.md)

